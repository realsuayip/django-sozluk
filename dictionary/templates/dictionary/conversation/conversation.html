{% extends "dictionary/base.html" %}
{% block title %}@{{ recipient.username }} ile sohbet muhabbet{% endblock %}

{% block content %}
    {% load humanize %}
    {% load filters %}
    {% include "dictionary/includes/block_user_modal.html" %}

    <h1 class="h4">
        <strong><a href="{{ recipient.get_absolute_url }}">@{{ recipient.username }}</a> ile sohbet muhabbet</strong>
    </h1>

    {% with messages=conversation.collection %}
        <div class="chat-quick-links d-flex justify-content-between">
            <div>
                <a href="{% url 'messages' %}" class="mr-2" title="癟ok oyaland覺m burda">
                    <svg fill="currentColor" width="24" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                        <use href="#arrow-left"></use>
                    </svg>
                    <span>mesajlara d繹n</span>
                </a>

                {% if recipient not in user.blocked.all %}
                    <a role="button" tabindex="0" title="terbiyesiz" class="block-user-trigger" data-username="{{ recipient.username }}">bu herifi engelle</a>
                {% endif %}
            </div>

            <div data-mode="present" data-id="{{ conversation.pk }}">
                <a role="button" tabindex="0" class="mr-3 chat-delete-individual">
                    <svg fill="currentColor" viewBox="0 0 16 16" width="16" height="16">
                        <use href="#trash"></use>
                        <title>sil</title>
                    </svg>
                    <span class="ml-1 d-none d-sm-inline-block">sil</span>
                </a>
                {% if messages|length > 0 %}
                    <a role="button" tabindex="0" class="chat-archive-individual">
                        <svg fill="currentColor" viewBox="0 0 16 16" width="16" height="16">
                            <use href="#archive"></use>
                            <title>arivle</title>
                        </svg>
                        <span class="ml-1 d-none d-sm-inline-block">arivle</span>
                    </a>
                {% endif %}
            </div>
        </div>

        <hr class="mt-1">


        {% if messages|length > 4 %}
            <a id="message_history_show" role="button" tabindex="0" title="aks覺n">sadece son 4 mesaj g繹steriliyor. t羹m mesajlar覺 g繹rmek i癟in t覺klay覺n</a>
        {% endif %}

        {% if messages %}
            <ul id="message_list" class="chat">
                {% for message in messages %}
                    {% if message.sender == user %}
                        <li class="bubble sent">
                            <p>{{ message.body|formatted|linebreaksbr }}</p>
                            <span class="date-info">
                            <time>{{ message.sent_at|naturaltime }}</time>
                                {% if message.read_at %}
                                    <span title="g繹r羹ld羹, {{ message.read_at|timesince }} 繹nce">
                                        <svg width="28" height="14" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                                            <use href="#msgread"></use>
                                        </svg>
                                    </span>
                                {% else %}
                                    <span title="g繹nderildi">
                                        <svg width="28" height="14" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                                            <use href="#msgsent"></use>
                                        </svg>
                                    </span>
                                {% endif %}
                            </span>
                        </li>
                    {% else %}
                        <li class="bubble recieved">
                            <p>{{ message.body|formatted|linebreaksbr }}</p>
                            <time>{{ message.sent_at|naturaltime }}</time>
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
            <hr>
        {% else %}
            <div class="border rounded-sm p-3 bg-light my-3">hi癟 mesaj kalmam覺 burda 仄</div>
        {% endif %}
    {% endwith %}


    {% if recipient.message_preference == "DS" or user == recipient or user in recipient.blocked.all or recipient in user.blocked.all %}
        <p style="text-align: center;">bu kullan覺c覺ya mesaj g繹nderemesiniz.</p>
    {% elif user.is_novice and recipient.message_preference == "AO" %}
        <p style="text-align: center;">bu kullan覺c覺ya mesaj g繹nderemesiniz.</p>
    {% elif user not in recipient.following.all and recipient.message_preference == "FO" %}
        <p style="text-align: center;">bu kullan覺c覺ya mesaj g繹nderemesiniz.</p>
    {% else %}
        <label for="message-body">
            <h2 class="h4">
                <span class="mr-2">mesaj yaz</span>
                <small style="font-size: 55%">(entry bi癟imlendirme se癟enekleri kullan覺labilir)</small>
            </h2>
        </label>
        <section class="chat-reply mb-3">
            {% load widget_tweaks %}
            <form method="POST">
                {% csrf_token %}
                {% render_field form.body|attr:"autofocus" id="message-body" class="mr-2 form-control" rows="5" spellcheck="true" %}
                <button type="submit" class="btn btn-django">g繹nder</button>
            </form>
        </section>
    {% endif %}
{% endblock %}